{% extends 'benchmarks/base.html' %}
{% load static %}
{% load compress %}

{% block main %}
{% include 'benchmarks/components/nav-bar.html' %}
<div class="container my_container landing">
    <section class="section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-half has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Dive Deeper:  Use Case 1- Preparing a ResNet-50 Model</h3>
                    <p>
                        One of the biggest benefits Brain-Score has to offer is integrative benchmarking, in which
                        a user can submit a model and see how it performs on many benchmarks, not just a single one.
                        Oftentimes this leads to new insights and correlations, as well as interesting findings.
                        We will explore how to do this in use Case 1- Preparing a ResNet-50 Model.
                        <br>
                        <strong>
                            Note that we will not actually submit your created model in this tutorial, as we do not
                            want to upload another resnet50_tutorial model. Please do not actually submit your tutorial model.
                        </strong>
                    </p>


                    <pre><code class="code-block">
                    /packaging_tutorial --> root folder to zip/unzip. This can be named anything.
                        /models --> the plugin type. This can also be benchmarks, data, or metrics.
                            /resnet50_tutorial --> the name of your submission
                                setup.py
                                model.py
                                test.py
                                __init__.py
                    </code></pre>

                       </p>
                </div>
            </div>
        </div>
    </section>
    <section class="section">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 1: Install Necessary Packages</h3>
                       <p> If you have not already, we highly recommend completing the quick start section above before
                           trying to submit a resnet50 model. Although completion is not required, the Quickstart
                           will give you a nice background into what model scores mean, and how to score a model
                           locally on a single, publicly available benchmark.
                           If you have already done the quick start, skip to step 2 Below. Otherwise, visit
                           please <a href="https://www.brain-score.org/tutorial/quickstart">here</a> to install the
                           necessary packages for Brain-Score.
                       </p>
                </div>
            </div>
            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 2: Download the starter submission Zip folder: </h3>
                       <p> Brain-Score allows users to submit plugins in two ways: directly to the site, via a Zip file
                           upload, or through a Github PR. In this deepdive, you will prepare a sample Zip project to
                           upload (but will not actually submit it), in order to learn the process of submitting.
                           In Deepdive 3, you will prepare to submit a model via Github Pull Request. The sample Zip
                           is a stock version of resnet50 pretrained on imagenet. You can download the sample zip file
                           <a href="{% static "/benchmarks/packaging_tutorial.zip" %}" download="packaging_tutorial.zip">here</a>.
                       </p>
                </div>
            </div>

           <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 3: Explore the starter submission file</h3>
                       <p> After unzipping the model.zip, you will see that it contains a folder called models
                           (the plugin), which in turn contains the model itself, named resnet50_tutorial.
                           This folder also contains 4 other Python files. The overall structure of the submission
                           package is below. *Note*: this would also be the same overall structure as your submission
                           package, if you are submitting any other plugins. Feel free to base your submission off of
                           this package, just do not submit the resnet50_tutorial model.
                       </p> </br>
                        <img class="submission example" width="500" height="auto" src="{% static "/benchmarks/img/submission_structure.png" %}" />

                    <p> Just like the sample submission, each submission that you submit must contain the 4 python
                        files above. Let’s explore these one by one, starting, naturally, with the __init__.py file:
                    </p>
                </div>
            </div>

            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 4: Modify the  __init__.py  file: </h3>
                       <p>This file adds your plugin to the Brain-Score plugin registry and to the Brain-Score
                           ecosystem at large. You are registering your model to a unique global identifier. You can
                           see that this file is fairly straightforward. Lines 1-3 are standard imports, and line 5
                           adds the plugin to the registry. Let’s go ahead and modify the identifier of our model,
                           from ResNet-50 to resnet50_tutorial_your-email. We can do this by changing line 5 to this:
                       </p>
<br><pre>
<code class="language-shell">
model_registry['resnet50_tutorial_your-email'] = lambda: ModelCommitment(identifier='resnet50', activations_model=get_model('resnet50'), layers=get_layers('resnet50'))
</code>
</pre><br>

                    <p> Which simply tells Brain-Score to use the resnet50 backend that already exists, but to give it
                        a new name, resnet50_tutorial_your-email. Note: Brain-Score does not allow duplicate plugin
                        names, so if you submit another version of the same model, make sure to make the identifier unique!
                        Also note: It would be prohibitively time- and resource-consuming to actually load every plugin
                        in a registry before they are needed, so the plugin discovery process relies on string parsing.
                        This unfortunately means that it’s not possible to programmatically add plugin identifiers to
                        the registry; each registration needs to be written explicitly in the form of
                        plugin_registry['my_plugin_identifier']
                        Next, let’s check out the setup.py file.
                    </p>
                </div>
            </div>

            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 5: Modify the setup.py  file:  </h3>
                       <p>This file is where you add any requirements that your model needs, in the requirements
                           dictionary on lines 6-7.If your model
                           had any extra requirements, such as a specific version of a package or an external git
                           repository, you would add it to the list defined on line 6. Lines 9 - 24 are just
                           administrative definitions, and can be left untouched.

                           Since our stock resnet50 model needs torch and torchvision, we will add those here, like so:
                       </p>

<br><pre>
<code class="language-python">
 requirements = [ “torchvision, “torch”]
</code>
</pre><br>
                </div>
            </div>


            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 6: Let’s Add a Model (with the model.py) file!
                    </h3>
                       <p>The 3rd of the 4 required files is the model.py file itself. Let’s explore this file in more
                           detail: Lines 1 - 9 are standard imports, and can be left alone for this tutorial. Lines
                           20-21 define the get_model_list() function that simply returns the model identifier. Let’s
                           change line 21 to be our model identifier instead:</p>
<br><pre>
<code class="language-python">
return ['resnet50_tutorial_your-email']
</code>
</pre><br>

                        <p>
                           Next, Lines 24-48 define the get_model() function that gets the model itself. Let’s change
                           lines 26 and 36 to be our identifier, like so (respectively): </p>
<br><pre>
<code class="language-python">
    assert name == 'resnet50_tutorial_your-email'
    wrapper = PytorchWrapper(identifier='resnet50_tutorial_your-email', model=model, preprocessing=preprocessing
</code>
</pre><br>
                          <p>
                           You can see on line 26 the model itself is being loaded from pytorch. If you have a custom
                           model that you have created yourself, check out our Custom Model Submission Guide here in
                           Deep Dive 2 Lines 41 - 43 contain the get_layers() function, which returns the layers you
                           are interested in scoring. We can leave the layers alone for this tutorial, but we need to
                           again modify the identifier to be our model’s on line 42:</p>
<br><pre>
<code class="language-python">
assert name == 'resnet50_tutorial_your-email'
</code>
</pre><br>

                    <p>
                           Lines 46 and 47 define the Bibtex for the model. You can leave this blank when submitting,
                           but we highly recommend you add a reference. For our tutorial purpose, we can leave this alone.
                           Finally, lines 80 - 83 defines a call to the Brain-Score scoring system to score our model
                           locally on a mock benchmark. We will revisit this once we create our test.py file, but for
                           now just know that this makes sure our syntax and everything else is ready for submission.
                           Let’s move on to the 4th and final required file for our submission, test.py
                       </p>
                </div>
            </div>

            <div class="columns is-centered">
                <div class="column is-three-quarters has-text-centered">
                    <h3 class="benefits_heading is-size-3-mobile">Step 7: Putting it all together
                    </h3>
                       <p>The final step in submitting a model is to run your model locally, as mentioned in step 6
                           above, to ensure that everything is in working order. Let’s open up our model.py folder,
                           and run the file itself. Once ran, this should produce the message below, indicating
                           that you are ready for submission: </p>
<br><pre>
<code class="language-python">
Test successful, you are ready to submit!
</code>
</pre><br>
                    <p>
                          Once you receive this message, you could rezip
                           (after you save everything, of course) our sample model.zip file,
                           and you would be good to submit your model.

                        <strong>Again, please do NOT actually submit the
                           model that you just created during this entire tutorial. This process was for illustration purposes only.

                        </strong>

                        <br>
                        When you submit an actual (non-tutorial) model, you will receive an email with your results
                        within 24 hours. (Most of the time it only takes 2-3 hours to score).
                        If you would like to know how to submit a custom model to Brain-Score, please visit the next
                        deepdive <a href="https://www.brain-score.org/tutorial/deepdive_2">here</a>.

                       </p>
                </div>
            </div>

        </div>
    </section>

</div>
{% endblock %}


