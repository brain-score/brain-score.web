{% extends 'benchmarks/base.html' %}

{% block content %}

    <section class="individual_model container center">
        <h1 class="title">{{ model.name }}</h1>
        {% if model.reference_identifier %}
            <a href="{{ model.reference_link }}">{{ model.reference_identifier }}</a>
        {% else %}
            <p class="no_reference">No reference paper on file</p>
        {% endif %}

        {# Benchmark scores #}
        <h2 id="scores" class="title-is-2">Benchmark scores</h2>
        <div class="benchmark_scores">
            {% for score_row in model.scores %}
                {% if score_row.score_ceiled %}
                    <div
                            class="benchmark_child_{{ score_row.benchmark.depth }}
                            {% if not score_row.benchmark|is_parent %}
                                box
                            {% endif %}"
                            {% if score_row.benchmark.parent %}
                            data-parent="{{ score_row.benchmark.parent.identifier }}"
                            {% endif %}
                    >
                        <table class="benchmarks">
                            <tr class="list_entry">
                                {# score #}
                                <td title="unceiled score: {{ score_row.score_raw }}"
                                    data-benchmark="{{ score_row.versioned_benchmark_identifier }}"
                                    data-parent="{{ benchmark_parents|get_parent_item:score_row.versioned_benchmark_identifier }}"
                                    class="score_cell displaySquare depth_{{ score_row.benchmark.depth }} clicker"
                                    style="{{ score_row.color }}; ">
                                    {{ score_row.score_ceiled }}
                                </td>
                                {# benchmark general info #}
                                <td>
                                    {# line 1#}
                                    <span class="benchmark_identifier">{{ score_row.benchmark.short_name }}</span>
                                    {% if score_row.benchmark.benchmark_type.reference and score_row.benchmark.benchmark_type.reference.url %}
                                        <a class="has-text-weight-normal"
                                           href="{{ score_row.benchmark.benchmark_type.reference.url }}">
                                            [reference]
                                        </a>
                                    {% endif %}
                                    {% if score_row.rank %}
                                        <span class="tag rank">
                                            rank {{ score_row.rank }}
                                        </span>
                                    {% endif %}
                                    <br/>
                                    {# line 2 #}
                                    {% if score_row.benchmark|is_parent %}
                                        <span class="want_to_click collapsible_control is_collapsible"
                                                {# collapse all benchmarks below 2 by default #}
                                                {% if score_row.benchmark.depth >= 1 %}
                                              data-initial="hidden"
                                                {% endif %}
                                              data-identifier="{{ score_row.benchmark.benchmark_type_id }}"></span>
                                        <span class="tag child_benchmarks">
                                            {{ score_row.benchmark.children|length }}
                                            benchmark{% if score_row.benchmark.children|length > 1 %}s{% endif %}
                                        </span>
                                    {% endif %}
                                </td>
                                {# bar #}
                                <td class="bar">
                                    <div class="bar_container">
                                        <div class="bar"
                                             style="background-color:{{ score_row.color }};
                                                     --score:{{ score_row.score_ceiled|score_style }}%;">
                                            {{ score_row.score_ceiled }}
                                        </div>
                                        <span class="label zero">0</span>
                                        <div title="ceiling" class="vertical_line ceiling"></div>
                                        <span class="label ceiling">ceiling</span>
                                        <div title="best" class="vertical_line best"
                                             style="left: {{ score_row.best }}%"></div>
                                        <span class="label best" style="left: {{ score_row.best }}%">best</span>
                                        <div title="median" class="vertical_line median"
                                             style="left: {{ score_row.median }}%"></div>
                                        <span class="label median" style="left: {{ score_row.median }}%">median</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td colspan="2">
                                    {% if not score_row.benchmark|is_parent %}
                                        <div class="benchmark_info">
                                            {% if score_row.benchmark.meta %}
                                                <div>
                                                    <span>
                                                        {% if score_row.benchmark.meta.number_of_recording_sites %}
                                                            recordings from
                                                            {{ score_row.benchmark.meta.number_of_recording_sites }}
                                                            sites in
                                                            {{ score_row.benchmark.meta.recording_sites }}
                                                        {% endif %}
                                                        {% if score_row.benchmark.meta.behavioral_task %}
                                                            {{ score_row.benchmark.meta.behavioral_task }} task
                                                        {% endif %}
                                                    </span>
                                                    <br/>
                                                    {% if score_row.benchmark.meta.number_of_images %}
                                                        <span>
                                                            {{ score_row.benchmark.meta.number_of_images }} images
                                                        </span>
                                                        <br/>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                            {# image samples #}
                                            <div class="samples_container is-overflow-wrap">
                                                {% for sample in '0123456789'|make_list %}
                                                    <img class="stimulus_sample"
                                                         src="/static/benchmarks/img/benchmark_samples/{{ score_row.versioned_benchmark_identifier }}/{{ sample }}.png"
                                                         alt="sample {{ sample }}"/>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                {% endif %}
            {% endfor %}
        </div>


        {# BrainModel info #}
        <h2 id="brainmodel" class="title-is-2">BrainModel translation</h2>
        <div class="content">
            <div class="box has-background-info-light has-text-info">
                Brain-Score operates on BrainModels. A BrainModel can be treated like an experimental subject, with
                methods such as recording from a cortical region and performing a behavioral task (see the
                <a href="https://brain-score.readthedocs.io/en/latest/modules/model_interface.html">docs</a>).

                Many models submitted to Brain-Score are what we call a BaseModel. These are often variants of
                models from the machine learning community without a particular commitment to the brain and no
                knowledge of what e.g. "V1" is. To engage with these models and for ease-of-use, such BaseModels
                are typically converted into BrainModels by making commitments to the brain such as committing
                layers to cortical regions on separate datasets.
            </div>

            {# visual degrees #}
            <div id="visual_degrees" class="card">
                <div class="card-content">
                    <p class="subtitle is-4">
                        degrees visual angle: {{ visual_degrees }}
                    </p>
                    <div class="box has-background-info-light has-text-info">
                        Models have to declare their field-of-view so that stimuli can be displayed like they were
                        displayed to experimental subjects.
                        For instance, if experimental stimuli were shown at 4 degrees and a model's field-of-view is
                        larger than that, then the stimuli are padded such that the core stimulus will make up 4 degrees
                        in the model's field-of-view.
                    </div>

                    {% if visual_degrees %}
                        <div class="columns">
                            <div class="column">
                                <p class="has-text-centered">base image presented at 8 degrees</p>
                                <figure class="image is-marginless is-256x256">
                                    <img src="/static/benchmarks/img/visual_degrees/{{ visual_degrees }}_to_8.png"
                                         alt="visual degrees {{ visual_degrees }} to 8"/>
                                </figure>
                            </div>
                            <div class="column">
                                <p class="has-text-centered">if benchmark presents image at 4 degrees, model sees</p>
                                <figure class="image is-marginless is-256x256">
                                    <img src="/static/benchmarks/img/visual_degrees/{{ visual_degrees }}_to_4.png"
                                         alt="visual degrees {{ visual_degrees }} to 4"/>
                                </figure>
                            </div>
                            <div class="column">
                                <p class="has-text-centered">if benchmark presents image at 12 degrees, model sees</p>
                                <figure class="image is-marginless is-256x256">
                                    <img src="/static/benchmarks/img/visual_degrees/{{ visual_degrees }}_to_12.png"
                                         alt="visual degrees {{ visual_degrees }} to 12"/>
                                </figure>
                            </div>
                        </div>
                    {% else %}
                        <div class="notification">
                            No visual degrees found for this model. The submission might have failed.
                        </div>
                    {% endif %}
                </div>
            </div>

            {# region-layer commitment #}
            <div class="card">
                <div class="card-content">
                    <p class="subtitle is-3">
                        layer commitment
                    </p>

                    <div class="box has-background-info-light has-text-info">
                        BaseModel layers have to be committed to cortical regions. For BaseModels that are automatically
                        translated into BrainModels this is done on separate public data.
                        The same layers are thus used when recording from the same cortical region, e.g. always the same
                        layer for V1 instead of different layers per benchmark.
                    </div>

                    {% if layers %}
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Region</th>
                                <th>Layer</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for region, layer in layers.items %}
                                <tr>
                                    <th>{{ region }}</th>
                                    <td>{{ layer }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <div class="notification">
                            No layer commitments found for this model. Older submissions might not have stored this
                            information but will be updated when evaluated on new benchmarks.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>


        {# Benchmarks bibtex #}
        <h2 class="title-is-2">
            <span class="want_to_click collapsible_control is_collapsible"
                  data-initial="hidden" data-target="bibtex_collapsible"></span>
            Benchmarks bibtex
        </h2>
        <div id="bibtex_collapsible" class="content">
            <div class="box">
                {% for score_row in model.scores %}
                    {% if score_row.score_ceiled and score_row.benchmark.benchmark_type.reference %}
                        <pre>{{ score_row.benchmark.benchmark_type.reference.bibtex|format_bibtex }}</pre>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </section>

{% endblock %}
