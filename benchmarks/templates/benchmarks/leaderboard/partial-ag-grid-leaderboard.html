{% load static %}


{# Override main_content to remove column constraints #}
  <div class="leaderboard-container">
    <div class="leaderboard-header">
      <!-- banner & icon‚Ä¶ -->
    </div>

    <div id="leaderboardSearchWrapper">
      <input type="text" id="modelSearchInput" placeholder="Search models or submitter... (try: 'alexnet OR vit', 'imagenet AND resnet', 'NOT ferguson')" />

      {% if domain == "vision" %}
      <button id="advancedFilterBtn" style="white-space: nowrap">
        <span class="filter-icon">üîç</span>
        <span class="text-wrapper">Advanced Filters</span>
      </button>
      {% endif %}

      <button id="tutorialBtn" class="btn-secondary" style="white-space: nowrap">
        <span class="tutorial-icon">üìö</span>
        <span class="text-wrapper">Tutorial</span>
      </button>


      <button id="exportCsvButton" class="btn-secondary" style="background-color: #47B7DE; color: white; border: none; white-space: nowrap" title="Export leaderboard data and plugin metadata">
        <i class="fa-solid fa-download"></i>  Export
      </button>
    </div>

    <div class="leaderboard-breadcrumb"></div>

    <div id="leaderboardGrid"
         class="ag-theme-alpine"
         style="width:100%;height:1500px;overflow-x:auto;">
    </div>

    {% if domain == "vision" %}
    <div id="advancedFiltersPanel" class="advanced-filters hidden">
      <div class="filters-container">
        <!-- Left column: Benchmark filters -->
        <div class="filter-column benchmark-column">
          <div class="filter-column-header">
            <h4>Included Benchmarks</h4>
            <div class="header-actions">
              <button id="copyBibtexBtn" class="btn-icon" title="Copy BibTeX citations for selected benchmarks">
                üìñ
              </button>
              <a href="#" id="resetBenchmarksLink" class="reset-link">Reset</a>
            </div>
          </div>
          <div id="benchmarkFilterPanel"></div>
        </div>

        <!-- Middle column: Model Properties -->
        <div class="filter-column">
          <div class="filter-column-header">
            <h4>Model Properties</h4>
          </div>

          <div class="filter-group">
            <label>Architecture</label>
            <div class="filter-dropdown" id="architectureFilter">
              <input type="text" placeholder="Select architecture..." class="filter-input">
              <div class="dropdown-content hidden">
                <!-- Options will be populated dynamically -->
              </div>
            </div>
          </div>

          <div class="filter-group">
            <label>Model Family</label>
            <div class="filter-dropdown" id="modelFamilyFilter">
              <input type="text" placeholder="Select model family..." class="filter-input">
              <div class="dropdown-content hidden"></div>
            </div>
          </div>

          <div class="filter-group">
            <div class="filter-header">
              <label>Parameter Count (M)</label>
              <div class="range-values">
                <input type="number" class="range-input-min" id="paramCountMin" min="0" max="100" value="0">
                <span class="range-separator">-</span>
                <input type="number" class="range-input-max" id="paramCountMax" min="0" max="100" value="100">
                <span class="range-unit">M</span>
              </div>
            </div>
            <div class="range-filter dual-handle">
              <div class="slider-container" data-min="0" data-max="100">
                <div class="slider-track"></div>
                <div class="slider-range"></div>
                <div class="slider-handle handle-min" data-value="0"></div>
                <div class="slider-handle handle-max" data-value="100"></div>
              </div>
            </div>
          </div>

          <div class="filter-group">
            <div class="filter-header">
              <label>Model Size (MB)</label>
              <div class="range-values">
                <input type="number" class="range-input-min" id="modelSizeMin" min="0" max="1000" value="0">
                <span class="range-separator">-</span>
                <input type="number" class="range-input-max" id="modelSizeMax" min="0" max="1000" value="1000">
                <span class="range-unit">MB</span>
              </div>
            </div>
            <div class="range-filter dual-handle">
              <div class="slider-container" data-min="0" data-max="1000">
                <div class="slider-track"></div>
                <div class="slider-range"></div>
                <div class="slider-handle handle-min" data-value="0"></div>
                <div class="slider-handle handle-max" data-value="1000"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right column: Benchmark Properties -->
        <div class="filter-column benchmark-metadata-column">
          <div class="filter-column-header">
            <h4>Benchmark Properties</h4>
          </div>

          <!-- Public Data Only -->
          <div class="filter-group">
              <label class="checkbox-label">
                <input type="checkbox" id="publicDataFilter">
                <span>Publicly Available Data Only</span>
              </label>
          </div>

          <!-- Benchmark Data Section -->
          <div class="metadata-section">
            <div class="filter-group checkbox-group">
              <label>Brain Region</label>
              <div class="checkbox-container" id="regionFilter">
                <label class="checkbox-label">
                  <input type="checkbox" value="V1" class="region-checkbox">
                  <span>V1</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" value="V2" class="region-checkbox">
                  <span>V2</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" value="V4" class="region-checkbox">
                  <span>V4</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" value="IT" class="region-checkbox">
                  <span>IT</span>
                </label>
              </div>
            </div>

            <div class="filter-group checkbox-group">
              <label>Species</label>
              <div class="checkbox-container" id="speciesFilter">
                <label class="checkbox-label">
                  <input type="checkbox" value="human" class="species-checkbox">
                  <span>Human</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" value="primate" class="species-checkbox">
                  <span>Simian</span>
                </label>
              </div>
            </div>

            <div class="filter-group checkbox-group">
              <label>Task</label>
              <div class="checkbox-container" id="taskFilter">
                <!-- Will be populated dynamically -->
              </div>
            </div>
          </div>

          <!-- Benchmark Stimuli Section -->
          <div class="metadata-section">
            <div class="filter-group">
              <div class="filter-header">
                <label>Number of Stimuli</label>
                <div class="range-values">
                  <input type="number" class="range-input-min" id="stimuliCountMin" min="0" max="1000" value="0">
                  <span class="range-separator">-</span>
                  <input type="number" class="range-input-max" id="stimuliCountMax" min="0" max="1000" value="1000">
                </div>
              </div>
              <div class="range-filter dual-handle">
                <div class="slider-container" data-min="0" data-max="1000">
                  <div class="slider-track"></div>
                  <div class="slider-range"></div>
                  <div class="slider-handle handle-min" data-value="0"></div>
                  <div class="slider-handle handle-max" data-value="1000"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="filter-actions">
        <button id="toggleLayoutBtn" class="btn-secondary">
          <span class="toggle-text">Sidebar Mode</span>
        </button>
        <button id="resetAllFiltersBtn" class="btn-primary">Reset All Filters</button>
      </div>
    </div>
    {% endif %}
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  {# Load AG-Grid UMD bundle #}
  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@33.2.4/dist/ag-grid-community.min.js"></script>

  {# Load tooltip component JS #}
  <script src="{% static 'benchmarks/js/components/tooltip.js' %}"></script>

  {# Load Driver.js for tutorial functionality #}
  <script src="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.js.iife.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.css"/>
  <script src="{% static 'benchmarks/js/tour-driver/tour-driver.js' %}"></script>
  <script src="{% static 'benchmarks/js/tour-driver/tour-state-manager.js' %}"></script>
  <script src="{% static 'benchmarks/js/tour-driver/tour-config-loader.js' %}"></script>
  <script src="{% static 'benchmarks/js/tour-configs/tour-helpers.js' %}"></script>
  <script src="{% static 'benchmarks/js/tour-configs/basic-tour-steps.js' %}"></script>
  <script src="{% static 'benchmarks/js/tour-configs/interactive-tour-steps.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard-tour.js' %}"></script>

  {# Load modular leaderboard components #}
  <script src="{% static 'benchmarks/js/leaderboard/core/constants.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/renderers/cell-renderers.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/renderers/header-components.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/search-filters.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/benchmark-filters.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/model-filters.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/range-filters.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/filter-coordinator.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/filters/search-filters.js' %}"></script>
  {% if domain == "vision" %}
  <script src="{% static 'benchmarks/js/leaderboard/navigation/url-state.js' %}"></script>
  {% endif %}
  <script src="{% static 'benchmarks/js/leaderboard/utilities/hierarchy-utils.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/export/csv-export.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/export/citation-export.js' %}"></script>
  <script src="{% static 'benchmarks/js/leaderboard/core/grid-initialization.js' %}"></script>
  <script src="{% static 'benchmarks/js/ag-grid-leaderboard.js' %}"></script>

  {# Pass Django data to JavaScript #}
  <script>
    window.DJANGO_DATA = {
      row_data: '{{ row_data|escapejs }}',
      column_defs: '{{ column_defs|escapejs }}',
      benchmark_groups: '{{ benchmark_groups|escapejs }}',
      benchmark_tree: '{{ benchmark_tree|escapejs }}',
      filter_options: '{{ filter_options|escapejs }}',
      benchmark_metadata: '{{ benchmark_metadata|escapejs }}',
      benchmark_ids: '{{ benchmark_ids|escapejs }}',
      model_metadata_map: '{{ model_metadata_map|escapejs }}',
      benchmarkStimuliMetaMap: '{{ benchmarkStimuliMetaMap|escapejs }}',
      benchmarkDataMetaMap: '{{ benchmarkDataMetaMap|escapejs }}',
      benchmarkMetricMetaMap: '{{ benchmarkMetricMetaMap|escapejs }}',
      domain: '{{ domain|escapejs }}'
    };
  </script>

  {# Load initialization script that handles the Django data #}
  <script src="{% static 'benchmarks/js/leaderboard/core/template-initialization.js' %}"></script>